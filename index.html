<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <style>
        .hidden {
            display: none;
        }

        .option-img {
            width: 200px;
            height: 200px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }

        .option-img:hover {
            border-color: #3273dc;
        }
    </style>
    <title>Image Selection Game</title>
</head>
<body>
    <!-- Homepage -->
    <div id="homepage" class="container">
        <h1 class="title mt-5">Which one are you more likely to purchase?</h1>
        <form id="start-form">
            <div class="field">
                <label class="label">Email</label>
                <div class="control">
                    <input class="input" type="email" id="email" placeholder="Enter your email" required>
                </div>
            </div>
            <button type="button" class="button is-primary" onclick="startGame()">Start Game</button>
        </form>
    </div>

    <!-- Game Section -->
    <div id="game" class="container hidden">
        <h3 class="subtitle mt-5">Which one will you purchase?</h3>
        <h2 class="subtitle mt-5">Round <span id="round-number">1</span> of 3</h2>
        <div class="columns is-centered">
            <div class="column is-narrow">
                <img src="" id="option1" class="option-img" onclick="selectOption('option1')" alt="Option 1">
            </div>
            <div class="column is-narrow">
                <img src="" id="option2" class="option-img" onclick="selectOption('option2')" alt="Option 2">
            </div>
        </div>
    </div>

    <!-- Thank You Message -->
    <div id="thankyou" class="container hidden">
        <h2 class="title mt-5">Thank you for participating!</h2>
    </div>

    <script>
        const totalRounds = 3;
        let currentRound = 0;
        let email = '';
        const responses = [];
        const options = [
            { option1: "image1.jpeg", option2: "image2.jpeg" },
            { option1: "image3.jpeg", option2: "image4.jpeg" },
            { option1: "image5.jpeg", option2: "image6.jpeg" }
        ];

        function sendToGoogleSheet(data) {
            // Create a URL-encoded string from the data
            const formDataString = data.map(entry => 
                `round=${encodeURIComponent(entry.round)}&choice=${encodeURIComponent(entry.choice)}&email=${encodeURIComponent(entry.email)}`
            ).join('&');

            fetch('https://script.google.com/macros/s/AKfycbzajj44iv5X91Wo9Onk6htVYEb34DexSItd1SstzuAkbXJjxMyZdkDt6tU2_aAU4z3KZg/exec',  {
                redirect: "follow",
                method: "POST",
                body: formDataString,  // Send URL-encoded form data
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded;charset=utf-8",  // Set the content type to URL-encoded
                },
            })
            .then(response => response.text())
            .then(result => {
                console.log('Success:', result);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function startGame() {
            const emailInput = document.getElementById('email');
            email = emailInput.value;

            if (!email) {
                alert('Please enter a valid email!');
                return;
            }

            document.getElementById('homepage').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            loadRound();
        }

        function loadRound() {
            if (currentRound >= totalRounds) {
                endGame();
                return;
            }

            const round = options[currentRound];
            document.getElementById('option1').src = round.option1;
            document.getElementById('option2').src = round.option2;
            document.getElementById('round-number').textContent = currentRound + 1;
        }

        function selectOption(selectedOption) {
            // Add response for current round to the responses array
            responses.push({
                round: currentRound + 1,
                choice: selectedOption,
                email: email
            });

            // Move to the next round
            currentRound++;

            // Load next round if any, otherwise end game
            loadRound();
        }

        function endGame() {
            // Hide game section and show thank you section
            document.getElementById('game').classList.add('hidden');
            document.getElementById('thankyou').classList.remove('hidden');

            // Send all responses to Google Sheets after all rounds
            sendToGoogleSheet(responses);
        }
    </script>
</body>
</html>
